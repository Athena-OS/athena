# AUR ( https://aur.archlinux.org/ )

pkgname=caido-desktop
pkgver=0.45.1
pkgrel=1
groups=('role-bountyhunter' 'role-student' 'role-webpentester' 'role-redteamer'
        'role-network' 'athena' 'athena-webapp' 'athena-proxy' 'athena-scanner'
        'athena-fuzzer')
pkgdesc='A lightweight web security auditing toolkit.'
arch=('x86_64')
url='https://caido.io/'
license=('private')
depends=('glibc' 'gcc-libs')
provides=(caido)
source=("https://caido.download/releases/v${pkgver}/caido-desktop-v${pkgver}-linux-x86_64.AppImage")
sha512sums=('cc83eaf715658163142c952b1c6215a70a7c99c4e4d9561051e9e6ad2e04db1cb9a47370552dcff23b69df6e3a5cbd89e04a1b6d8807e1c6c4914a82bde8527e')

prepare() {
  chmod +x *.AppImage
  ./*.AppImage --appimage-extract
  mv squashfs-root/ ${srcdir}/build
}

package() {
  install -dm 755 "$pkgdir/usr/bin"
  install -dm 755 "$pkgdir/opt/$pkgname"

  cp -a "${srcdir}/build/usr/share" "$pkgdir"
  cp -aR "${srcdir}/build"/* "$pkgdir/opt/$pkgname/"
  ln -s "/opt/$pkgname/caido" "$pkgdir/usr/bin/$provides"
  find "$pkgdir/opt/$pkgname" -type d -exec chmod 755 {} +

  sed -i 's|Exec=AppRun --no-sandbox %U|Exec=caido|' "build/caido.desktop"
  install -Dm 644 "build/caido.desktop" -t "$pkgdir/usr/share/applications/"
  install -Dm 644 "build/caido.png" -t "$pkgdir/usr/share/icons/hicolor/256x256/apps/"
}

