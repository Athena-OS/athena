# Credits BlackArch ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=truecrack
pkgver=64.50eca69
pkgrel=1
# this depends on cuda, which is about as large as the entire repo,
# so we leave it out of the 'athena' group
groups=('athena' 'athena-cracker')
pkgdesc='Password cracking for truecrypt(c) volumes.'
url='https://github.com/lvaccaro/truecrack'
arch=('x86_64')
license=('GPL-3.0-or-later')
depends=('cuda')
source=("git+https://github.com/lvaccaro/$pkgname.git"
        "add-missing-flags.patch"
        "fix-multiple-declarations.patch")
sha512sums=('SKIP'
            '16f46f044b0161e80308fbcb91ea74b4a14fbd28b1ae89611a38c464828c39808c6554a6d6a7be07d9a309dbfad7c0b80939c815bee160c4512c374b042f482a'
            'ba54f56548bf3702f696eb89640b789865a4eabe6e3caff04dbbb7859324a9bf601d13e1d69d648880fbed26cf1a43a8a795dd979b4f3872a02fd9a4ecf35243')

pkgver() {
  cd $pkgname

  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

prepare() {
  cd $pkgname

  patch -p1 < "$srcdir/add-missing-flags.patch"
  patch -p1 < "$srcdir/fix-multiple-declarations.patch"
}

build() {
  cd $pkgname

  export PATH=$PATH:/opt/cuda/bin

  ./configure --enable-cpu --prefix=/usr --datarootdir=/usr/share --mandir=/usr/share/man

  make
}

package() {
  cd $pkgname

  make DESTDIR="$pkgdir" install
}

