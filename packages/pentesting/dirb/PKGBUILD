# Credits BlackArch ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=dirb
pkgver=2.b59dab6
pkgrel=1
groups=('athena' 'athena-scanner' 'athena-webapp')
pkgdesc='A web content scanner, brute forcing for hidden files.'
url='https://dirb.sourceforge.net/'
arch=('x86_64' 'aarch64')
license=('GPL-2.0-or-later')
depends=('curl')
source=(
	"git+https://github.com/v0re/$pkgname.git"
	"GCC-now-defaults-to-fno-common.-Use-the-common-modul.patch"
)
sha512sums=('SKIP'
            '76b4463f4bb7d3baae5c1d0ea6137e44c0840d1e60028283673ac03ea2f644e81a7c81627bd2eb69c86e75e52515c3d012bc1fff1a90798acd6839ea565370b5')

pkgver() {
	cd $pkgname

	echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

prepare() {
	cd $pkgname

	patch -p1 < "${srcdir}/GCC-now-defaults-to-fno-common.-Use-the-common-modul.patch"
}

build () {
	cd $pkgname
	
	./configure --prefix=/usr
	make
}

package() {
	cd $pkgname

	make DESTDIR="${pkgdir}" install
	mkdir -p "${pkgdir}/usr/share/${pkgname}/"
	cp -r "wordlists" "${pkgdir}/usr/share/${pkgname}/"
	# Avoid file conflict with icu
	mv "${pkgdir}/usr/bin/gendict" "${pkgdir}/usr/bin/gendict_dirb"
	chmod -R 755 "${pkgdir}/usr/share/${pkgname}/wordlists"
}
