# Credits BlackArch ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=nzyme
pkgver=1.2.2
pkgrel=1
pkgdesc='WiFi defense system.'
arch=('any')
groups=('role-network' 'athena' 'athena-wireless' 'athena-defensive')
url='https://www.nzyme.org'
license=('custom:SSPL')
depends=('java-environment')
makedepends=('git' 'maven')
source=("git+https://github.com/nzymedefense/$pkgname.git"
        "https://raw.githubusercontent.com/nzymedefense/$pkgname/master/$pkgname.conf.example"
        "https://raw.githubusercontent.com/nzymedefense/$pkgname/master/tap/$pkgname-tap.conf.example")
noextract=("$pkgname-$pkgver.jar")
sha512sums=('SKIP'
            '8298d82f729e9dcaae1d46c7b00cc367c7051b16c88d291fe493ef5bb8d83a8864ae228e334e41716fa8ffbe55f576b20a6f9a923136131d753b8fbbcd19ef50'
            '83d4b2dfd630b9e365a07efafa3fa45018848620ae47d6d7b41dd9e36c7c5f6df3e4414bf5047c6df45884c9035cd237c13f45f7af78287c391c2652d2e2460b')

pkgver() {
  cd $pkgname

  git describe --long --tags | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

build() {
  cd $pkgname

  sed -i 's/lennartkoopmann/nzymedefense/g' pom.xml
  mvn package -DskipTests=true
}

package() {
  cd $pkgname
  
  install -dm 755 "$pkgdir/usr/bin"

  install -Dm 644 "$pkgname-$pkgver.jar" \
    "$pkgdir/usr/share/$pkgname/$pkgname-$pkgver.jar"

  install -m 644 -t "$pkgdir/usr/share/$pkgname/" *.example

  cat > "$pkgdir/usr/bin/$pkgname" << EOF
#!/bin/sh
exec java -jar /usr/share/$pkgname/$pkgname-$pkgver.jar "\$@"
EOF

  chmod +x "$pkgdir/usr/bin/$pkgname"
}

