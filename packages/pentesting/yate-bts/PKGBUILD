# Credits BlackArch ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=yatebts
pkgver=649.9b289b4
pkgrel=1
pkgdesc='An open source GSM Base Station software.'
groups=('athena' 'athena-radio')
arch=('x86_64' 'aarch64')
url='https://github.com/yatevoip/yatebts'
license=('GPL-1.0-or-later')
depends=('yate')
source=("git+https://github.com/yatevoip/yatebts"
        'gcc.patch')
sha512sums=('SKIP'
            '9a43558c2a467ef66975191776ef21e1eab08dfd9c4ead07eef45b44231d68f1b36bbea93ec075de06ef45ba43a501bf346d9501643ceff1fbf1f9ee43f1c22b')
backup=('etc/yate/snmp_data.conf'
        'etc/yate/ybts.conf'
        'etc/yate/tmsidata.conf'
        'etc/yate/subscribers.conf')
optdepends=('nginx: nipc_web support'
            'apache: nipc_web support'
            'php-fpm: nipc_web support')

pkgver() {
  cd $pkgname

  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

prepare() {
  cd $pkgname

  patch -Np1 -i "$srcdir/gcc.patch"
}

build() {
  cd $pkgname
  ./autogen.sh
  ./configure --prefix=/usr \
              --sysconfdir=/etc
  make
}

package(){
  cd $pkgname

  make DESTDIR=$pkgdir install --no-api

  touch "$pkgdir/etc/yate/snmp_data.conf" "$pkgdir/etc/yate/tmsidata.conf"
}

