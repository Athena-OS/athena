# Credits BlackArch ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=armitage
pkgver=1268.991244e
pkgrel=1
groups=('athena' 'athena-exploitation' 'athena-automation')
pkgdesc='A graphical cyber attack management tool for Metasploit.'
url='https://github.com/r00t0v3rr1d3/armitage'
arch=('any')
license=('GPL-1.0-or-later')
depends=('metasploit' 'jdk11-openjdk' 'nmap' 'postgresql' 'ruby-msgpack')
makedepends=('ant' 'zip' 'unzip' 'subversion')
install='armitage.install'
source=("git+https://github.com/r00t0v3rr1d3/$pkgname.git"
        'armitage.install')
sha512sums=('SKIP'
            '6c987c243d2a3a232a1f062a62ff028160fe6aa22296b3a29672b4b3e0a717250de5cd2bda09501789599746ed74f1ccfbbef9f5366dab6eb37c41d38c7c1869')

pkgver() {
  cd $pkgname

  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

build() {
  cd $pkgname

  ./package.sh
}

package() {
  cd $pkgname

  install -dm 755 "$pkgdir/usr/bin"
  install -dm 755 "$pkgdir/usr/share/$pkgname"

  install -Dm644 -t "$pkgdir/usr/share/doc/$pkgname" readme.txt whatsnew.txt

  rm readme.txt whatsnew.txt

  cp -a * "$pkgdir/usr/share/$pkgname"

  cat > "$pkgdir/usr/bin/$pkgname" << EOF
#!/bin/sh
cd /usr/share/armitage/release/unix
exec ./armitage "\$@"
EOF

  chmod +x "$pkgdir/usr/bin/$pkgname"

  cat > "$pkgdir/usr/bin/teamserver" << EOF
#!/bin/sh
cd /usr/share/armitage
exec ./teamserver "\$@"
EOF

  chmod +x "$pkgdir/usr/bin/teamserver"
}

