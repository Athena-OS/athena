From: Sophie Brun <sophie@offensive-security.com>
Date: Wed, 23 Jun 2021 18:24:56 +0200
Subject: Fix multiple definitions

---
 src/asl.c        |  2 +-
 src/dhcpclient.c |  8 ++++----
 src/dhcpconfig.c |  3 ---
 src/lldp.c       |  2 +-
 src/main.c       |  5 ++---
 src/voiphop.c    | 19 +++++++++----------
 6 files changed, 17 insertions(+), 22 deletions(-)

diff --git a/src/asl.c b/src/asl.c
index 0fd88da..4f9b3eb 100644
--- a/src/asl.c
+++ b/src/asl.c
@@ -30,7 +30,7 @@
 #define ETH_HEADER_SIZE 14
 
 char *device;
-pcap_t *handle;
+extern pcap_t *handle;
 int host_count_n = 0;
 int host_count_d = 0;
 int packet_count_d = 0;
diff --git a/src/dhcpclient.c b/src/dhcpclient.c
index d3e7f66..7c6389c 100755
--- a/src/dhcpclient.c
+++ b/src/dhcpclient.c
@@ -71,15 +71,15 @@ extern	unsigned short	ip_id;
 extern  void		*(*currState)();
 extern  time_t          TimeOut;
 extern  unsigned        nleaseTime;
-extern  struct in_addr  inform_ipaddr;
+struct in_addr  inform_ipaddr;
 extern	int		DoCheckSum;
 extern	int		TestCase;
 extern	int		resolv_renamed,yp_renamed,ntp_renamed;
 extern	int		InitialHostName_len,InitialDomainName_len;
 extern	char		*InitialHostName,*InitialDomainName;
-int			avvid;
-int			nvvid;
-int			tvvid;
+extern  int		avvid;
+extern  int		nvvid;
+extern  int		tvvid;
 extern  int		*avvid2;
 extern  int		*nvvid2;
 extern  int		*tvvid2;
diff --git a/src/dhcpconfig.c b/src/dhcpconfig.c
index cf83b3e..c3ed164 100755
--- a/src/dhcpconfig.c
+++ b/src/dhcpconfig.c
@@ -55,7 +55,6 @@ extern	int			IfName_len,IfNameExt_len;
 extern	char			*IfName,*IfNameExt,*Cfilename,*ConfigDir;
 extern	char			**ProgramEnviron;
 extern	unsigned char		ClientHwAddr[ETH_ALEN],*ClientID;
-extern	struct in_addr		default_router;
 extern	dhcpInterface		DhcpIface;
 extern	dhcpOptions		DhcpOptions;
 extern	const dhcpMessage	*DhcpMsgRecv;
@@ -315,8 +314,6 @@ int dhcpConfig()
 	for (i=0;i<DhcpOptions.len[routersOnSubnet];i+=4)
 	  setDefaultRoute(DhcpOptions.val[routersOnSubnet]);
     }
-  else
-    if ( default_router.s_addr > 0 ) setDefaultRoute((char *)&(default_router.s_addr));
 
   /* rebind dhcpSocket after changing ip address to avoid problems with 2.0 kernels */
 #ifdef OLD_LINUX_VERSION
diff --git a/src/lldp.c b/src/lldp.c
index ed47cb2..79f333d 100644
--- a/src/lldp.c
+++ b/src/lldp.c
@@ -93,7 +93,7 @@ pcap_t *handle;
 struct pcap_pkthdr *header;
 const u_char *packet;
 struct bpf_program fp;
-char errbuf[PCAP_ERRBUF_SIZE];
+static char errbuf[PCAP_ERRBUF_SIZE];
 bpf_u_int32 mask;
 bpf_u_int32 net;
 
diff --git a/src/main.c b/src/main.c
index 295cdc3..b215a62 100755
--- a/src/main.c
+++ b/src/main.c
@@ -79,7 +79,6 @@
 #define DEFAULT_NUMBER  100;
 #define DEFAULT_LENGTH  1400;
 
-struct in_addr  inform_ipaddr,default_router;
 int avaya_vvid_disc;
 int nortel_vvid_disc;
 int alcatel_vvid_disc;
@@ -127,7 +126,7 @@ extern int 		*avvid2;
 extern int 		*nvvid2;
 extern int 		*tvvid2;
 extern char 		apattern[];
-char 		vinterface[BUFSIZ];
+extern char 		vinterface[BUFSIZ];
 int debug_yes = 0;
 int macy = 0;
 char *set_mac     = NULL;
@@ -138,7 +137,7 @@ extern void *sniffer_main(void *threadarg);
 
 extern u_char CDP_DEST;
 #define CDP_FRAME_SIZE 1700
-u_char cdpframe[CDP_FRAME_SIZE];
+extern u_char cdpframe[CDP_FRAME_SIZE];
 
 #if 0
 unsigned char   ClientMACaddr[ETH_ALEN];
diff --git a/src/voiphop.c b/src/voiphop.c
index b568eaf..20f22da 100755
--- a/src/voiphop.c
+++ b/src/voiphop.c
@@ -84,15 +84,15 @@ int             ClientMACaddr_ind =     0;
 
 int ass_cdp_vvid_discovered = 0;
 extern int cdpmode;
-char errbuf[PCAP_ERRBUF_SIZE];
-pcap_t *handle;
-struct bpf_program fp;
-bpf_u_int32 mask;
-bpf_u_int32 net;
-const u_char *packet;
-struct pcap_pkthdr *header;
-
-packet_ifconfig_t     packet_ifconfig;
+static char errbuf[PCAP_ERRBUF_SIZE];
+extern pcap_t *handle;
+extern struct bpf_program fp;
+extern bpf_u_int32 mask;
+extern bpf_u_int32 net;
+extern const u_char *packet;
+extern struct pcap_pkthdr *header;
+
+extern packet_ifconfig_t     packet_ifconfig;
 int spoofed_cdp_packet_len = 0;
 
 void *send_cdp(void *);
@@ -100,7 +100,6 @@ extern void *(*currState)();
 
 /*************** DHCP variables ********************/
 
-struct in_addr  inform_ipaddr,default_router;
 char            *ProgramName    =       NULL;
 char            **ProgramEnviron=       NULL;
 char            *IfName         =       DEFAULT_IFNAME;