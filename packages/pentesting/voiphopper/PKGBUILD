# Credits BlackArch ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=voiphopper
pkgver=2.04
pkgrel=7
groups=('athena' 'athena-automation' 'athena-voip')
pkgdesc='A security validation tool that tests to see if a PC can mimic the behavior of an IP Phone. It rapidly automates a VLAN Hop into the Voice VLAN.'
arch=('x86_64' 'aarch64')
url='https://voiphopper.sourceforge.net/'
license=('GPL-3.0-or-later')
depends=('libpcap' 'gcc')
source=("https://downloads.sourceforge.net/sourceforge/$pkgname/$pkgname-$pkgver.tar.gz"
        "Add-missing-includes.patch"
        "Update-for-tirpc.patch"
        "fix-include.patch"
        "fix-multiple-definitions.patch")
sha512sums=('6b8afcd5600c719e6470a64d84083269405b5548477c9221636b48aad295634839c621ebb7b736680acb64c987a3311d95929ab5d041419aa5375471ef773e29'
            '4bd2503fa13a672f73e27f4c970f046133dd5e8ee73a7ab056be765a8934b4d50a6eb29ae7ddb607572cf5123b2dacf6bb7f86193eb40d4db20cf67e3266145b'
            'be93b35830d18f3e4ceaa933e7d662bf026f1e8ed014d09095a8bee822c456e7ebeb517cd1ed12d87f05f6790c98e7e5c3d02c7bb2e0c922837dde199caeaf9c'
            '31e051932ab27d25e315b39592255268154d5ce748f6ca53a585a454ed041843151f4bec83ba80410ec4b41eb98bc15352ccb6a58811e31a2c73696afee8c0c7'
            '3fe3998f0b7bce21046cc1c94967dd82a13821ac34ec312455f6f851312f6e89be6a5977a3049002de7e31e465475b5654c83ac8b1735f67cf06bb4a98b9ff34')

prepare() {
  cd "$pkgname-$pkgver"

  patch -p1 < "$srcdir/Add-missing-includes.patch"
  patch -p1 < "$srcdir/Update-for-tirpc.patch"
  patch -p1 < "$srcdir/fix-include.patch"
  patch -p1 < "$srcdir/fix-multiple-definitions.patch"
}

build() {
  cd "$pkgname-$pkgver"

  ./configure --prefix=/usr --mandir=/usr/share/man --libexecdir=/usr/lib

  sed -i "s%<linux/if_ether.h>%<netinet/if_ether.h>%" src/dhcpclient.h
  sed -i "s%<linux/if_tr.h>%<netinet/if_tr.h>%" src/dhcpclient.h

  make
}

package() {
  cd "$pkgname-$pkgver"

  install -dm 755 "$pkgdir/usr/bin"

  make DESTDIR="$pkgdir" install

  install -Dm 644 -t "$pkgdir/usr/share/doc/$pkgname/" README BUGS
}

