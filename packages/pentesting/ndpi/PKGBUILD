# Credits BlackArch ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=ndpi
pkgver=4.8
pkgrel=1
pkgdesc="Open and Extensible GPLv3 Deep Packet Inspection Library"
arch=('i686' 'x86_64')
url="http://www.ntop.org/products/ndpi/"
license=('GPL-3.0-or-later')
conflicts=('ndpi-svn')
depends=('libcap')
makedepends=('json-c' 'libmaxminddb' 'libpcap' 'libtool' 'numactl' 'pcre2' 'rrdtool')
source=("https://github.com/ntop/nDPI/archive/${pkgver}.tar.gz")
sha512sums=('f76eb99a83262a6d148509c7ce457b9af35dce3657c8191405ba15999b25c323ee0bee2907b0a7e6ba6f12a63182fde839e0098a4e8e0f63999e600526f3036b')

build() {
  cd "${srcdir}/nDPI-${pkgver}"
  
  unset CPPFLAGS
  ./autogen.sh
  ./configure \
    --prefix=/usr \
    --with-pic \
    --includedir=/include \
    --libdir=/usr/lib
  make
}

package() {
  cd "${srcdir}/nDPI-${pkgver}"

  make DESTDIR="$pkgdir" install
  mv $pkgdir/usr/usr/lib/* $pkgdir/usr/lib/
  rm -rf $pkgdir/usr/usr
#  ln -sf /usr/include/ndpi \
#    "${pkgdir}/usr/include/libndpi"
}
