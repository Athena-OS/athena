# Credits BlackArch ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=samdump2
pkgver=3.0.0
pkgrel=5
groups=('athena' 'athena-cracker')
pkgdesc='Dump password hashes from a Windows NT/2k/XP installation.'
arch=('x86_64' 'aarch64')
url='http://sourceforge.net/projects/ophcrack/files/samdump2/'
license=('GPL-1.0-or-later')
depends=('openssl')
source=("http://downloads.sourceforge.net/ophcrack/$pkgname-$pkgver.tar.bz2"
        "10_ftbfs_link.patch"
        "20_compiler_flags.patch"
        "30_install_infos.patch"
        "40_manpage_formatting.patch"
        "50_openssl.patch")
sha512sums=('57ff1f761e833346887ac7fdbc76e202822b306ce0a35af2a491dafc7b277836f3f113be6703c71be82828e8442e6ecd320cb88f4dcc7c5fbf7f2ca257abea95'
            '90cc4d078bbab55155f8276c5f6305a8e8f3224c5b1b2e0c29468b79ccb14e12be54813ac8f06e2888d2dea2af41d9e61030e718a37e52c6dda39f0e071baea0'
            '5eaf6e0716e31a4c813c4034e9006344f858792252faac68c09af2e17b79e417dae002afd1daf4daed300afa9060346cd86a1ab6bb29b56c794a61c8a8cac900'
            '88be3dfd9aca384d05b8da1ac601da1bbe6b196d07f6322c04d849f61514db27cef9d9ac4a938480c9b30487bf51a93719c2071bdc1ad09c75ed38f2319f17e6'
            '2bd2627fb1098bc734c313e547739be8c6ec400e60536540e531b840c42c4e3f1aa3a56ddc6da51cab0c0ed1ca7c8ec9754d3a95e22bd798284e64f2b3b1ac81'
            '6db06d65f684f823a06692ee4756b6a6e524c847c135ab327af141353035073c92376a8f0c24626e9e3923369eef78e921cfeaeccb5dd2fe355cc242adefeeab')

prepare() {
  cd "$pkgname-$pkgver"

  patch -p1 < "$srcdir/10_ftbfs_link.patch"
  patch -p1 < "$srcdir/20_compiler_flags.patch"
  patch -p1 < "$srcdir/30_install_infos.patch"
  patch -p1 < "$srcdir/40_manpage_formatting.patch"
  patch -p1 < "$srcdir/50_openssl.patch"
}

package() {
  cd "$pkgname-$pkgver"

  make LIBS=-lcrypto PREFIX="/usr" DESTDIR="$pkgdir" install
}

