# Credits BlackArch ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=irpas
pkgver=46.1e3c9ab
pkgrel=1
groups=('athena' 'athena-exploitation')
pkgdesc='Internetwork Routing Protocol Attack Suite.'
arch=('x86_64' 'aarch64')
url='https://salsa.debian.org/pkg-security-team/irpas'
license=('custom:unknown')
depends=('libpcap' 'libtirpc')
source=("git+https://salsa.debian.org/pkg-security-team/$pkgname.git"
        "add-missing-header.patch"
        "comment-out-endif.patch"
        "fix-makefile.patch"
        "fix-spelling-error.patch"
        "use-debian-libpcap.patch")
sha512sums=('SKIP'
            '6448483c81241a1245bd0f78d5d0920bea9f74f774ecdf6a74582d311179ff116b85d40f67fef619263d4ae981ef0f78ebc0a8500bac894bff4190b6167528a2'
            '32ff970659e63cc1d243ab6ac642cc8e342b89a1d9f7da327a6c14ee71641bfda557447a31406615bbd90a0a0d647b43a063ebb7cb074b92a6b96ed77ba1881c'
            '564b385fd1e0f51abbce9b8697574977b1cc8c438198c932cdb87b5d891175366f64caf4360635d2282f9f3c7a68656815db5702741aca96e36e66e1a9585533'
            '36dff2fb4feb1ce7966fededf1f05ae564c9b3caa23d1ec5330924cad94f317438255e06ebafd44db824404a16d91aaf299f114631bbd681ed57a727b0313856'
            '763c9f828375312a0384936406158eee80ed3ce80d44ebdecc2042d613bc00accc92b24e3c536a9e4b94aba5c8fb3d64c44efda2b48de7ac8100c0e0a1338e71')

pkgver() {
  cd $pkgname

  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

prepare() {
  cd $pkgname

  patch -p1 < "$srcdir/add-missing-header.patch"
  patch -p1 < "$srcdir/comment-out-endif.patch"
  patch -p1 < "$srcdir/fix-makefile.patch"
  patch -p1 < "$srcdir/fix-spelling-error.patch"
  patch -p1 < "$srcdir/use-debian-libpcap.patch"
}

build() {
  cd $pkgname

  # Solve rpc/types.h not found error
  CFLAGS="$CFLAGS -I/usr/include/tirpc/"
  make
}

package() {
  cd $pkgname

  install -dm 755 "$pkgdir/usr/bin"

  for bin in dhcpx itrace tctrace ass file2cable dfkaa cdp hsrp icmp_redirect \
    igrp irdp irdpresponder netenum protos timestamp ; do
    install -m 755 "$bin" "$pkgdir/usr/bin/$pkgname-$bin"
  done
  # netmask has been removed on for loop because not compiling
}

