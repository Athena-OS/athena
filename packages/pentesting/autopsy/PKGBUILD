# Credits BlackArch ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=autopsy
pkgver=4.21.0
_skver=4.12.1
pkgrel=2
epoch=1
pkgdesc='The forensic browser. A GUI for the Sleuth Kit.'
groups=('athena' 'athena-forensic')
arch=('x86_64')
url='https://github.com/sleuthkit/autopsy'
license=('MIT' 'Apache-2.0')
depends=('java-runtime' 'testdisk' 'sleuthkit' 'sleuthkit-java' 'python-pytsk3')
source=("https://github.com/sleuthkit/autopsy/releases/download/$pkgname-$pkgver/$pkgname-$pkgver.zip"
        "$pkgname.desktop")
sha512sums=('ce84748f1d0fc51d2015aac0a15a291262d6f50a157d2d8ba30f78450dca1a9620016e18604789179beba4a92d26b6b823825ca61ece643fcecb6f2b8c172c8f'
            'cc99141bf78fd8e1a857c5ba85de285c5b3f4c2d7483b0692679e6b5e7de15a5838ec7786f03fd1c814c586540bc5e2b4d2de1badf57e5a408bd9abfe89981bf')

package() {
  cd "$pkgname-$pkgver"

  install -dm 755 "$pkgdir/usr/bin"
  install -dm 755 "$pkgdir/opt/$pkgname"

  cp -r * "$pkgdir/opt/$pkgname/"

  rm -f \
    "$pkgdir/opt/$pkgname/$pkgname/modules/ext/sleuthkit-postgresql-$_skver.jar"
  ln -sf "/usr/share/java/sleuthkit-$_skver.jar" \
    "$pkgdir/opt/$pkgname/$pkgname/modules/ext/sleuthkit-postgresql-$_skver.jar"
  ln -sf "/usr/share/java/sleuthkit-$_skver.jar" \
    "$pkgdir/opt/autopsy/autopsy/modules/ext/sleuthkit-$_skver.jar"

  install -m 755 "bin/$pkgname" "$pkgdir/opt/$pkgname/bin/$pkgname"
  install -Dm 644 icon.ico "$pkgdir/usr/share/pixmaps/$pkgname.ico"
  install -Dm 644 "$srcdir/$pkgname.desktop" \
    "$pkgdir/usr/share/applications/$pkgname.desktop"

  ln -sf "/opt/$pkgname/bin/$pkgname" "$pkgdir/usr/bin/$pkgname"
}
