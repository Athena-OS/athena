# Credits BlackArch ( https://www.blackarch.org/ ).
# See COPYING for license details.

pkgname=logkeys
pkgver=0.2.0.r11.g98aac72
pkgrel=1
pkgdesc='A GNU/Linux keylogger that worked.'
groups=('athena' 'athena-keylogger')
url='https://github.com/kernc/logkeys'
arch=('any')
license=('GPL-3.0-or-later')
depends=('procps-ng' 'kbd')
optdepends=('logkeys-keymaps: for additional keymaps')
makedepends=('git')
install=logkeys.install
backup=('etc/conf.d/logkeysd')
source=("git+https://github.com/kernc/$pkgname.git"
        "logkeysd.conf" "logkeys.service")
sha512sums=('SKIP'
            'f897b9f04bcf4f5e010c363e3b966d84fe62eb47b2f18292e1db5bd55dd5a275f7a8708df17682eda0611c330b7cd4c9feb14fb60867b98d302b34f58c8b7f39'
            'f45ca513449ffa7288829dcf9516cb1edbf3bf9f658e5bcf71dec2f0bb1e5d0e17a66dd18ce722b032036b0a05783b475a5cdc9622c070c32049684ad0dc5594')

pkgver() {
  cd $pkgname

  ( set -o pipefail
    git describe --long --tags --abbrev=7 2>/dev/null |
      sed 's/\([^-]*-g\)/r\1/;s/-/./g' ||
    printf "%s.%s" "$(git rev-list --count HEAD)" \
      "$(git rev-parse --short=7 HEAD)"
  )
}

build() {
	cd "$pkgname"

	./autogen.sh
	cd "build"
	../configure --prefix=/usr --sysconfdir=/etc
	make
}

package() {
	cd "$pkgname/build"
  
	make prefix="$pkgdir/usr" sysconfdir="$pkgdir/etc" install

	install -Dm0644 "$srcdir/logkeysd.conf" "$pkgdir/etc/conf.d/logkeysd"
	install -Dm0644 "$srcdir/logkeys.service" "$pkgdir/usr/lib/systemd/system/logkeys.service"

	cd "../keymaps"
	for filename in $(ls *.map); do
		install -D -m 644 "${filename}" "${pkgdir}/usr/share/lkmaps/${filename}"
	done
}

